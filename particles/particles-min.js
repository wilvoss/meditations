var wandDiv,textP,oldTempX,oldTempY,spatter,down,fade,useGPU,dark,makeSlow,blurry,sticky,stream,showPrefs,mix,mixTimer,isStain,timerTick,showOptions,backgroundDiv,mouseDetected=!1,touchDetected=!1,tempX=500,tempY=100,count=1,useDrift=!0,colorIndex=0,speed=1,sizeFactor=1,bgdIndex=0,spreadFactor=1,tickIndex=0,fixed=!1,bgdColors=["0.0","0.3","0.7"],transtionType=WhichTransitionEvent(),freeCanvases=new Array,iOS=!1,presets=GetById("presets"),keyCommands=GetById("keyCommands"),toggleCommands=GetById("toggleCommands"),header=GetById("header"),elementCount=0,optionKeyPressed=!1,currentPreset="";function Create(e){return"canvas"==e&&elementCount++,document.createElement(e)}function GetById(e){return document.getElementById(e)}function GetMouseXY(e){return e.preventDefault(),mouseDetected||touchDetected||StartMagic(),tempX=e.clientX,tempY=e.clientY,null==tempX&&(tempX=150),null==tempY&&(tempY=200),mouseDetected=!0}function touchMove(e){e.preventDefault(),trackTouch(e)}function touchStart(e){trackTouch(e)}function trackTouch(e){return mouseDetected||touchDetected||StartMagic(),tempX=e.touches[0].pageX,tempY=e.touches[0].pageY,tempX<0&&(tempX=0),tempY<0&&(tempY=0),touchDetected=!0}function AddCss(e){var t=Create("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}function UpdateLayout(){tickIndex>=17&&(DisplayParticle(),tickIndex=0),tickIndex++}function FlipOptions(){showOptions=!showOptions,keyCommands.style.display=showOptions?"block":"none"}function StartMagic(){(wandDiv=Create("div")).style.width="100%",wandDiv.style.height=window.innerHeight+"px",wandDiv.id="wandDiv",wandDiv.style.msUserSelect="none",wandDiv.style.position="absolute",wandDiv.style.top="0px",wandDiv.style.left="0px",wandDiv.style.msTouchAction="none",wandDiv.style.pointerEvents="none",wandDiv.style.userSelect="none",wandDiv.style.msUserSelect="none",document.body.insertBefore(wandDiv,document.body.firstChild),AddCss(".particle {position: absolute; background-size: 100%;background-repeat: no-repeat;backface-visibility: hidden;}"),document.onkeydown=function(e){e=window.event||e,optionKeyPressed=e.altKey},document.onkeyup=function(e){switch(e=window.event||e,optionKeyPressed=e.altKey,e.keyCode){case 27:FlipOptions();case 49:sizeFactor=0,BumpSize();break;case 50:sizeFactor=1,BumpSize();break;case 51:sizeFactor=2,BumpSize();break;case 52:sizeFactor=3,BumpSize();break;case 53:sizeFactor=4,BumpSize();break;case 54:sizeFactor=5,BumpSize();break;case 55:sizeFactor=6,BumpSize();break;case 56:sizeFactor=7,BumpSize();break;case 57:sizeFactor=8,BumpSize();break;case 58:sizeFactor=9,BumpSize();break;case 48:sizeFactor=10,BumpSize();break;case 66:FlipBlur();break;case 67:CycleColor();break;case 68:FlipDirection();break;case 85:ToggleUseDrift();break;case 72:FlipSmoke();break;case 76:DarkenBackground();break;case 80:BumpSpread();break;case 82:FlipSpatter();break;case 83:FlipStream();break;case 87:FlipSlowMotion()}},FlipSpatter(),FlipStream(),CycleColor(),FlipDirection(),FlipGPU(),sticky=!1,sizeFactor=1,BumpSize();window.setInterval(DisplayParticle,5)}function AdjustDrift(){var e=Math.floor(180*Math.random()/(12-sizeFactor));return Math.round(Math.random())>0&&(e=-e),e}function FlipGPU(){useGPU=!useGPU}function FlipSlowMotion(){speed=(makeSlow=!makeSlow)?3:1}function FlipSticky(){sticky=!sticky}function FlipBlur(){blurry=!blurry}function FlipDirection(){down=!down}function FlipStream(){stream=!stream}function FlipSpatter(){spatter=!spatter}function CycleColor(){switch(colorIndex++,null!=mixTimer&&window.clearTimeout(mixTimer),colorIndex){case 0:mix=dark=!1;break;case 1:dark=!0,mix=!1;break;case 2:mix=!0,mixTimer=window.setInterval(FlipSmoke,50),colorIndex=-1}}function FlipSmoke(){dark=!dark}function Flipmix(){mix=!mix}function BumpSize(){11==sizeFactor&&(sizeFactor=0),sizeFactor++}function BumpSpread(){spatter&&(spreadFactor>=40&&(spreadFactor=-4),spreadFactor+=5)}iOS&&(header.className="iOSHeader");var showCommands=!1;function ToggleCommands(){showCommands=!showCommands,presets.style.display=showCommands?"none":"block",keyCommands.style.display=showCommands?"block":"none",toggleCommands.innerHTML=showCommands?"&larr; PRESETS":"COMMANDS &rarr;"}function ToggleUseDrift(){useDrift=!useDrift}function DarkenBackground(){bgdIndex==bgdColors.length-1&&(bgdIndex=-1),bgdIndex++,wandDiv.style.background="rgba(0,0,0,+"+bgdColors[bgdIndex]+")"}function WhichTransitionEvent(){var e,t=Create("fakeelement"),a={transition:"transitionend"};for(e in a)if(void 0!==t.style[e])return a[e]}function UsePreset(e){switch(spatter=fade=isStain=!1,useDrift=!0,e){case"spore":sizeFactor=colorIndex=0,down=!1,useDrift=!1,spatter=stream=makeSlow=blurry=!0,bgdIndex=2,spreadFactor=39;break;case"airbubbles":colorIndex=-1,down=!1,spatter=stream=makeSlow=blurry=!0,sizeFactor=0,bgdIndex=1,spreadFactor=20;break;case"pollution":down=!1,spatter=stream=makeSlow=blurry=!0,sizeFactor=4,colorIndex=1,bgdIndex=0,spreadFactor=-4,useDrift=!1;break;case"cigarette":colorIndex=-1,down=!1,fade=stream=makeSlow=blurry=!0,bgdIndex=0,sizeFactor=1,useDrift=!1,spreadFactor=-4;break;case"steam":colorIndex=-1,down=!1,fade=spatter=stream=makeSlow=blurry=!0,sizeFactor=3,bgdIndex=0,useDrift=!1,spreadFactor=-4;break;case"sludge":colorIndex=0,stream=makeSlow=blurry=down=!0,useDrift=!1,sizeFactor=6,bgdIndex=-1,spreadFactor=-4;break;case"waterfall":colorIndex=-1,stream=blurry=down=!0,spatter=makeSlow=!1,sizeFactor=4,useDrift=!1,bgdIndex=1,spreadFactor=-4;break;case"trachea":colorIndex=1,stream=down=makeSlow=!0,blurry=spatter=!1,sizeFactor=2,bgdIndex=-1,spreadFactor=0;break;case"snow":colorIndex=-1,spatter=stream=makeSlow=blurry=down=!0,useDrift=!1,sizeFactor=0,bgdIndex=1,spreadFactor=39;break;case"champagne":colorIndex=-1,makeSlow=blurry=down=!1,spatter=stream=!0,sizeFactor=0,bgdIndex=1,fade=1,spreadFactor=4;break;case"stain":fade=1,colorIndex=0,spatter=stream=makeSlow=down=!1,isStain=blurry=!0,sizeFactor=3,bgdIndex=2,spreadFactor=-1}useDrift=!useDrift,down=!down,blurry=!blurry,makeSlow=!makeSlow,stream=!stream,spatter=!spatter,FlipDirection(),FlipSpatter(),FlipSlowMotion(),FlipStream(),FlipBlur(),CycleColor(),DarkenBackground(),BumpSize(),BumpSpread()}function DisplayParticle(){if(fixed||(mouseDetected||touchDetected)&&(stream||oldTempX!=tempX&&oldTempY!=tempY)){var e=freeCanvases.length>0?freeCanvases.pop():Create("canvas");e.hasBeenAdded||wandDiv.appendChild(e),e.construct=new function(){var t,a=5*sizeFactor*sizeFactor+Math.floor(10*Math.random()*sizeFactor),o=a/2,r=dark?"0,0,0":"255,255,255",n=dark?".55":".65",s=blurry?"0":n;e.height=a,e.width=a,e.className="particle",e.getContext&&(context=e.getContext("2d")),gradient=context.createRadialGradient(o,o,0,o,o,o),gradient.addColorStop(0,"rgba("+r+","+n+")"),gradient.addColorStop(1,"rgba("+r+","+s+")"),context.fillStyle=gradient,context.beginPath(),context.arc(o,o,a/2,0,2*Math.PI,!0),context.closePath(),context.fill(),oldTempX=tempX,oldTempY=tempY,t=.25+.25*Math.random(),r=o=0,spatter&&(o=Math.floor(20*Math.random()*sizeFactor*spreadFactor)),spatter&&(r=Math.floor(20*Math.random()*sizeFactor*spreadFactor)),e.style.opacity=t.toFixed(2);let i=spatter?1:2;const d=(fixed?380:tempX)-e.offsetWidth/i+o+"px",c=(fixed?window.innerHeight/i:tempY)-e.offsetHeight/i+r+"px";e.style.left=d,e.style.top=c;var l,p=function(){var t="all "+parseInt(speed)+"s ease-in 0s";e.style.transition=t;var o=0;useDrift&&(o=AdjustDrift()),fade&&(e.style.opacity=0),useGPU?(t=down?wandDiv.offsetHeight-e.offsetTop-e.offsetHeight/2+2+"px":-e.offsetTop-e.offsetHeight-2+"px",e.style.transform="translate("+o+"px,"+t+")"):(t=down?wandDiv.offsetHeight-e.offsetHeight/2+2+"px":-e.offsetHeight-a-2+"px",e.style.top=t,e.style.left=e.offsetLeft+o+"px"),window.clearTimeout(l),window.setTimeout(m,1e3*parseInt(speed))},m=function(){var t=sticky?down?"all "+parseInt(speed)+"s ease-out 1.5s":"all "+parseInt(speed)+"s ease-out 0s":"opacity"+parseInt(speed)+"s ease-in "+parseInt(speed)/2;e.style.transition=t,e.style.opacity=0;var a=sticky?1.5+parseInt(speed):parseInt(speed);window.setTimeout(u,1e3*a)},u=function(){e.style.transition="none",e.style.transform="none",e.getContext&&(context=e.getContext("2d")),context.clearRect(0,0,0,0),e.construct=null,e.hasBeenAdded=!0,freeCanvases.push(e)};l=isStain?window.setTimeout(p,5e3):window.setTimeout(p,5)}}}function reOrient(){GetById("wandDiv").style.height=window.innerHeight+"px"}window.addEventListener("orientationchange",reOrient,!1),window.addEventListener("touchmove",touchMove,!1),window.addEventListener("touchstart",touchStart,!1),window.onpointermove=GetMouseXY,window.onload=GetMouseXY;